--FORÇANDO ALGUNS ERROS 


DECLARE
  VCOD     TALUNO.COD_ALUNO%TYPE := 1; --COLOCANDO OUTRO NUMERO AQUI, ENTRA EM 'ALUNO INEXISTENTE
  VCIDADE  TALUNO.CIDADE%TYPE;
  X NUMBER;
BEGIN
  SELECT CIDADE INTO VCIDADE
  FROM TALUNO
  WHERE COD_ALUNO = VCOD; --COLOCANDO 'WHERE NOME LIKE', POR EXEMPLO, ENTRA EM 'REGISTRO DUPLICADO'.
  X := 0 / 0;             --CASO ESTEJA TUDO CORRETO ACIMA, AQUI DARÁ O ERRO 'EXCEÇÃO DESCONHECIDA'
  DBMS_OUTPUT.PUT_LINE('CIDADE: '||VCIDADE);
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RAISE_APPLICATION_ERROR(-20001, 'ALUNO INEXISTENTE! '||SQLCODE||' '||SQLERRM);
  
  WHEN TOO_MANY_ROWS THEN
    RAISE_APPLICATION_ERROR(-20002, 'REGISTRO DUPLICADO! '||SQLCODE||' '||SQLERRM);
  
  WHEN OTHERS THEN
    RAISE_APPLICATION_ERROR(-20003, 'EXCECÃO DESCONHECIDA! '||SQLCODE||' '||SQLERRM);
END;    
      



--FORÇANDO MAIS ERROS. AGORA CONTROLADO (POR REGRAS DE NEGOCIO)


CREATE TABLE CONTAS                 --CRIANDO TABELA CONTAS
(
 CODIGO INTEGER NOT NULL PRIMARY KEY,
 VALOR  NUMBER (10, 2),
 JUROS  NUMBER (10, 2),
 VENCIMENTO DATE
);

--INSERINDO REGISTRO
INSERT INTO CONTAS VALUES (100, 550, 50, SYSDATE-10);

SELECT * FROM CONTAS;
COMMIT;

DECLARE
  VDT_VENCIMENTO DATE;
  VCONTA NUMBER := 100;
  ECONTA_VENCIDA EXCEPTION;
BEGIN
  SELECT VENCIMENTO INTO VDT_VENCIMENTO
  FROM CONTAS WHERE CODIGO = VCONTA;
  IF VDT_VENCIMENTO < TRUNC(SYSDATE) THEN
    RAISE ECONTA_VENCIDA;       --RAISE-> FORÇA UMA EXCEÇÃO, UM ERRO. NO CASO É TOTALMENTE CONTROLADO POR REGRAS DE NEGÓCIO
  END IF;
EXCEPTION
  WHEN ECONTA_VENCIDA THEN
    DBMS_OUTPUT.PUT_LINE('CONTA VENCIDA');
    UPDATE CONTAS SET
    VALOR = VALOR + JUROS
    WHERE CODIGO = VCONTA;
END;

SELECT * FROM CONTAS;


--UTILIZANDO PRAGMA EXCEPTION INIT -> PARA INTERCEPTAR UM ERRO
DECLARE
  EFK_INEXISTENTE EXCEPTION;                      --CRIANDO UMA EXCEÇÃO     
  PRAGMA EXCEPTION_INIT(EFK_INEXISTENTE, -02291); --INTERCEPTANDO O CÓDIGO. SE O COD DER ERRO SERÁ TRANSFORMADO NO EFK_INEXISTENTE
BEGIN
  INSERT INTO TBAIRRO VALUES(100, 100, 'ERRO');   --CASO NAO EXISTA ERRO PRE-DEFINIDO NÃO É POSSIVEL FORÇÁ-LO NO WHEN. POR ISSO FOI CRIADA UMA VARIAVEL DO TIPO EXCEPTION
EXCEPTION
  WHEN EFK_INEXISTENTE THEN
    RAISE_APPLICATION_ERROR(-20200, 'CIDADE NÃO EXISTE!!' );
END;

SELECT * FROM TBAIRRO;
SELECT * FROM TCIDADE;


	