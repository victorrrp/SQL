--FUNCOES DE GRUPO


/*COUNT - RETORNA O NÚMERO DE VALORES.
(VALORES NULOS NÃO SERÃO CONTADOS) DA COLUNA ESPECIFICADA
ABAIXO ESTAO TODOS OS VALORES ESPECIFICADOS DA TABELA TCONTRATO*/
SELECT COUNT(*)    AS QTD_REGISTROS,
       AVG(TOTAL)  AS MEDIA,
       ROUND(AVG(TOTAL),2)  AS MEDIA,
       MAX(TOTAL)  AS MAXIMO,
       MIN(TOTAL)  AS MINIMO,
       SUM(TOTAL)  AS SOMA,
       MAX(DATA)   AS DATA_MAIOR,
       MIN(DATA)   AS DATA_MENOR
FROM TCONTRATO;


SELECT * FROM TCONTRATO

--BUSCANDO APENAS A UMA INFORMAÇÃO NA TABELA
SELECT MAX(COD_CONTRATO) + 1 AS PROXIMO_CODIGO
FROM TCONTRATO;

/*BUSCANDO TOTAL DE CONTRATOS POR ALUNO. 
TODAS AS COLUNAS QUE NÃO TÊM FUNÇÃO DE GRUPO (SUM, MAX, AVG DENTRE OUTROS),
É NECESSARIO UTILIZAR O GROUP BY*/
SELECT COD_ALUNO,
       COUNT(*) AS QTD_CONTRATO,
       SUM(TOTAL) AS VALOR_TOTAL
FROM TCONTRATO
GROUP BY COD_ALUNO;


SELECT TO_CHAR(TRUNC(SYSDATE), 'DD/MM/YYYY') AS DATA FROM DUAL

--AGRUPANDO POR DATA (PARA ISSO UTILIZE O TRUNC, SENAO SERÁ AGRUPADO POR HORA)
SELECT TO_CHAR(TRUNC(DATA), 'DD/MM/YYYY') AS DATA,
       SUM(TOTAL) AS SOMA,
       AVG(TOTAL) AS MEDIA,
       COUNT(*)   AS QTD
FROM TCONTRATO
GROUP BY TRUNC(DATA)
ORDER BY DATA DESC


UPDATE TCONTRATO SET
       DESCONTO = NULL
WHERE COD_CONTRATO = 4;

UPDATE TCONTRATO SET
       DESCONTO = NULL
WHERE COD_CONTRATO = 3;


SELECT COUNT(*) AS QTD_REGISTROS
FROM TCONTRATO;

SELECT * FROM TCONTRATO


--UTILIZANDO COUNT PARA EXECUTAR O MESMO PROCESSO ACIMA.
--O COUNT NAO CONTABILIZA VALORES NULOS
SELECT COUNT(DESCONTO)
FROM TCONTRATO;


SELECT * FROM TALUNO;

SELECT COUNT(ESTADO) AS ESTADOS FROM TALUNO;


--UTILIZANDO COUNT COM DISTINCT(NÃO PERMITINDO VALORES REPETIDOS)
SELECT COUNT(DISTINCT(ESTADO)) AS ESTADOS_NAO_REP FROM TALUNO;


--BUSCANDO QUANTIDADE DE REGISTROS POR ESTADOS
SELECT ESTADO, COUNT(*)
FROM TALUNO
GROUP BY ESTADO;


--FAZENDO SELECT UTILIZANDO FUNCOES DE GRUPO
SELECT
       SUM(DESCONTO),
       AVG(DESCONTO),
       COUNT(DESCONTO),
       ROUND(AVG(NVL(DESCONTO, 0)),2)
FROM TCONTRATO;


--TOTAL DE CONTRATO POR ESTADO E DATA
SELECT ALU.ESTADO,
       SUM(CON.TOTAL) TOTAL, COUNT(*) QTD

FROM TALUNO ALU, TCONTRATO CON
WHERE ALU.COD_ALUNO = CON.COD_ALUNO
GROUP BY ALU.ESTADO
ORDER BY ALU.ESTADO;

--HAVING -> FILTRANDO COLUNA COM FUNÇAO DE GRUPO
SELECT COD_ALUNO, AVG(TOTAL) MEDIA
FROM TCONTRATO
WHERE COD_ALUNO > 0
HAVING AVG(TOTAL) > 500
GROUP BY COD_ALUNO
ORDER BY COD_ALUNO; 


--OUTRA FORMA DE UTILIZAR O HAVING
SELECT COD_ALUNO, AVG(TOTAL) MEDIA
FROM TCONTRATO
WHERE COD_ALUNO > 0
GROUP BY COD_ALUNO
HAVING AVG(TOTAL) > 500
ORDER BY COD_ALUNO; 


--MEDIA MAIS ALTA POR ALUNO
SELECT MAX(AVG(TOTAL))
FROM TCONTRATO
GROUP BY COD_ALUNO;


--SOMA DOS SALARIOS POR ESTADO ORDENADO PELO TOTAL
SELECT ESTADO, SUM(SALARIO) AS TOTAL
FROM TALUNO
GROUP BY ESTADO
ORDER BY 2 DESC; --A PARTIR DA COLUNA 2






