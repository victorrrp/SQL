--VIEW -> BASICAMENTE UM SELECT ARMAZENADO EM FORMA DE OBJETO
--PARA FAZER UMA VIEW SOMENTE DE LEITURA É NECESSÁRIO UTLIZAR 'WITH READ ONLY'.
--EM VIEW DE LEITURA NÃO É PERMITIDO FAZER DML


CREATE OR REPLACE VIEW V_ALUNO
AS
  SELECT COD_ALUNO AS CODIGO, SALARIO, ESTADO,
         NOME AS ALUNO, CIDADE
  FROM TALUNO
  WHERE ESTADO = 'RJ';

--USANDO A VIEW
SELECT * FROM V_ALUNO
ORDER BY ALUNO;

CREATE OR REPLACE VIEW V_CONTRATO_TOP
AS
  SELECT COD_CONTRATO, DESCONTO
  FROM TCONTRATO
  WHERE DESCONTO > 10;

SELECT * FROM V_CONTRATO_TOP;


--BUSCANDO NOME E CONTEÚDO DAS VIEWS
SELECT VIEW_NAME, TEXT
FROM USER_VIEWS;


--VIEW COM PARAMETROS DE SAIDA
CREATE OR REPLACE VIEW V_ALUNO2(COD, ALUNO, SAL)
AS
  SELECT COD_ALUNO, NOME, SALARIO
  FROM TALUNO;
  
SELECT * FROM V_ALUNO2;


--VIEW COMPLEXA (UTILIZANDO FUNÇÕES DE GRUPO)
--NÃO SE PODE FAZER DML POR SE TRATAR DE UMA VIEW COMPLEXA
CREATE OR REPLACE VIEW V_CONTRATO
AS
  SELECT TRUNC(DATA) AS DATA,
         MAX(DESCONTO) MAXIMO,
         AVG(DESCONTO) MEDIA,
         COUNT(*) QTD
  FROM TCONTRATO
  GROUP BY TRUNC(DATA);

SELECT * FROM V_CONTRATO;


--VIEW SIMPLES (FILTRANDO BUSCA)
CREATE OR REPLACE VIEW V_PESSOA_F
AS
  SELECT COD_PESSOA, TIPO, NOME, COD_RUA AS RUA
  FROM TPESSOA
  WHERE TIPO='F';
  
SELECT * FROM V_PESSOA_F;


--EXEMPLO DE CONSULTA USANDO VIEW E TABELA
SELECT PES.COD_PESSOA AS CODIGO,
       PES.NOME AS PESSOA,
       CID.NOME AS CIDADE,
       RUA.NOME AS RUA
FROM V_PESSOA_F PES, T_RUA RUA, TCIDADE CID
WHERE PES.RUA = RUA.COD_RUA(+)
AND CID.COD_CIDADE = RUA.COD_CIDADE
ORDER BY PES.NOME;



--OPERAÇÃO DML NA VIEW
CREATE OR REPLACE VIEW VCURSOS1000CK
AS
  SELECT COD_CURSO, NOME, VALOR
  FROM TCURSO
  WHERE VALOR = 1000
  WITH CHECK OPTION CONSTRAINT VCURSO1000_CK;

INSERT INTO VCURSOS1000CK
       (COD_CURSO, NOME, VALOR)
VALUES (52, 'TESTE Y', 1000);

SELECT * FROM TCURSO; 


--DELETE EM VIEW
DELETE FROM V_ALUNO WHERE CODIGO = 6;

SELECT * FROM V_ALUNO;


--INSERT EM VIEW
INSERT INTO V_ALUNO
VALUES (6, 1120, 'RJ', 'FRIDA', 'NITEROI');

DELETE FROM V_ALUNO3;

