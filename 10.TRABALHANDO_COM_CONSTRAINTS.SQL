/*UTILIZANDO CONSTRAINTS (RESTRIÇÕES) ->
GARANTEM REGRAS A NIVEL DE TABELA (SÃO ESTABELECIDAS NA CRIAÇÃO);
PREVINEM A EXCLUSAO DE UMA TABELA SE EXISTIREM DEPENDÊNCIAS*/

TALUNO
 COD_ALUNO        --PK - CHAVE PRIMARIA

TCONTRATO
 COD_CONTRATO     --PK - CHAVE PRIMARIA
 COD_ALUNO        --FK - CHAVE ESTRANGEIRA (CHAVE PRIMARIA QUE VEM DE OUTRA TABELA)


SELECT * FROM USER_CONSTRAINTS;
SELECT * FROM ALL_CONSTRAINTS; 


--CRIANDO TABELAS E UTILIZANDO RESTRIÇÕES. PRIMARIAS E ESTRANGEIRAS
--AS RESTRIÇÕES NÃO PERMITEM QUE HAJAM CONFLITOS NAS TABELAS
CREATE TABLE TCIDADE
(
  COD_CIDADE INTEGER NOT NULL,
  NOME VARCHAR2(40), 
  CONSTRAINT PK_CIDADE PRIMARY KEY (COD_CIDADE)
); 


CREATE TABLE TBAIRRO
(
  COD_CIDADE INTEGER NOT NULL,
  COD_BAIRRO INTEGER NOT NULL,
  NOME       VARCHAR(40),
  CONSTRAINT PK_BAIRRO PRIMARY KEY (COD_CIDADE, COD_BAIRRO)
);
 
 
--ADICIONANDO CHAVE ESTRANGEIRA PARA LIGAR TABELA DE BAIRRO COM TABELA DE CIDADE 
ALTER TABLE TBAIRRO
ADD CONSTRAINT FK_COD_CIDADE
FOREIGN KEY (COD_CIDADE)
REFERENCES TCIDADE(COD_CIDADE);


CREATE TABLE T_RUA
(
  COD_RUA INTEGER NOT NULL, 
  COD_CIDADE INTEGER,
  COD_BAIRRO INTEGER,
  NOME VARCHAR(40),
  CONSTRAINT PK_RUA PRIMARY KEY(COD_RUA)
);


 
--ADICIONANDO CHAVE ESTRANGEIRA PARA LIGAR TABELA DE RUA COM TABELA DE BAIRRO
ALTER TABLE T_RUA 
ADD CONSTRAINT FK_CIDADEBAIRRO
FOREIGN KEY(COD_CIDADE, COD_BAIRRO)
REFERENCES TBAIRRO(COD_CIDADE, COD_BAIRRO);


--CRIANDO TABELA TPESSOA
CREATE TABLE TPESSOA
(
  COD_PESSOA INTEGER           NOT NULL,      
  TIPO       VARCHAR2(1)       NOT NULL,
  NOME       VARCHAR2(30)      NOT NULL,
  PESSOA     VARCHAR(1)        NOT NULL,
  COD_RUA    INTEGER           NOT NULL,
  CPF        VARCHAR2(15)      ,
  CONSTRAINT PK_PESSOA PRIMARY KEY (COD_PESSOA)
);

--UNIQUE KEY - RESTRIÇÃO DENTRO DA TABELA
ALTER TABLE TPESSOA ADD CONSTRAINT UK_CPF UNIQUE(CPF);


--LIGANDO A TABELA PESSOA COM TABELA RUA
ALTER TABLE TPESSOA
ADD CONSTRAINT FK_PESSOA_RUA
FOREIGN KEY (COD_RUA)
REFERENCES T_RUA;


--INSERINDO CIDADES
INSERT INTO TCIDADE VALUES(1, 'NOVO HAMBURGO');
INSERT INTO TCIDADE VALUES(2, 'IVOTI');
INSERT INTO TCIDADE VALUES(3, 'SAPIRANGA');
INSERT INTO TCIDADE VALUES(4, 'TAQUARA');

SELECT * FROM TCIDADE;


--INSERINDO BAIRROS
INSERT INTO TBAIRRO VALUES(1,1, 'CENTRO');
INSERT INTO TBAIRRO VALUES(2,1, 'RIO BRANCO');
INSERT INTO TBAIRRO VALUES(3,1, 'CENTRO');
INSERT INTO TBAIRRO VALUES(4,1, 'FRITZ');

SELECT * FROM TBAIRRO;

--INSERINDO RUAS
INSERT INTO T_RUA VALUES(1,1,1, 'MARCILIO DIAS');
INSERT INTO T_RUA VALUES(2,2,1, 'FRITZ');
INSERT INTO T_RUA VALUES(3,3,1, 'JACOBINA');
INSERT INTO T_RUA VALUES(4,3,1, 'JOAO DA SILVA');

SELECT * FROM T_RUA;


ALTER TABLE TPESSOA ADD CONSTRAINT CK_PESSOA_TIPO
CHECK (TIPO IN ('C', 'F'));

ALTER TABLE TPESSOA ADD CONSTRAINT CK_PESSOA_JF
CHECK (PESSOA IN ('J', 'F'));


--EXCLUIR CONSTRAINT
ALTER TABLE TPESSOA DROP CONSTRAINT NOME_CONSTRAINT;

SELECT * FROM TPESSOA;

INSERT INTO TPESSOA VALUES(1, 'C', 'MARCIO', 'F', 1, '1234');
INSERT INTO TPESSOA VALUES(2, 'F', 'BEATRIZ', 'F', 2, '123');
INSERT INTO TPESSOA VALUES(3, 'F', 'PEDRO', 'F', 3, '12345');
INSERT INTO TPESSOA VALUES(4, 'C', 'MARIA', 'J', 4, '1236');


SELECT * FROM TPESSOA;



--CHECAGEM NA TABELA DE CONTRATO
ALTER TABLE TCONTRATO 
ADD CONSTRAINT CK_CONTRATO_DESCONTO
CHECK (DESCONTO BETWEEN 0 AND 30);

SELECT * FROM TCONTRATO;


--HABILITANDO E DESABILITANDO CONSTRAINTS;
ALTER TABLE TPESSOA DISABLE CONSTRAINT UK_CPF;
ALTER TABLE TPESSOA ENABLE CONSTRAINT UK_CPF;

--VISUALIZANDO CONSTRAINTS NA TABELA
SELECT * FROM USER_CONSTRAINTS
WHERE TABLE_NAME = 'TPESSOA';

