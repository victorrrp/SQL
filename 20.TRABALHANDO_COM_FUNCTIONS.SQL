--CRIAÇÃO E MANUTENÇÃO DE FUNCTIONS
--PARA CRIAÇÃO DE FUNCTIONS E PROCEDURES É NECESSÁRIO UTILIZAR CREATE OR REPLACE


--CRIANDO FUNCTION PARA INFORMAR PREÇO DO CURSO POR CÓDIGO INFORMADO
CREATE OR REPLACE FUNCTION CONSULTA_PRECO
(PCOD_CURSO NUMBER) RETURN NUMBER        --PRECO DO CURSO SERÁ RETORNADO ASSIM QUE O USUÁRIO INFORMAR O PCOD_CURSO
AS
  VVALOR NUMBER;
BEGIN
  SELECT VALOR INTO VVALOR FROM TCURSO
  WHERE COD_CURSO = PCOD_CURSO;
  
  RETURN(VVALOR);
END;


--TESTE (UTILIZANDO A FUNCTION)
DECLARE
  VCOD NUMBER := &CODIGO;  --CAIXA DE DIALOGO PEDINDO CODIGO
  VVALOR NUMBER;           --VALOR DO CURSO REFERENTE AO CODIGO INFORMADO
BEGIN
  VVALOR := CONSULTA_PRECO(VCOD);
  DBMS_OUTPUT.PUT_LINE('PREÇO DO CURSO: '||VVALOR);
END;

SELECT * FROM TCURSO;


--CRIANDO FUNCTION QUE RETORNA BOOLEAN (SE ALUNO ESTIVER CADASTRADO = TRUE, SE NÃO = FALSE)
CREATE OR REPLACE FUNCTION EXISTE_ALUNO
(PCOD_ALUNO IN TALUNO.COD_ALUNO%TYPE)
RETURN BOOLEAN            --TRUE OR FALSE
IS
  VALUNO NUMBER(10);       --VARIAVEL TIPO NUMBER
BEGIN
  SELECT COD_ALUNO 
  INTO   VALUNO
  FROM   TALUNO
  WHERE  COD_ALUNO = PCOD_ALUNO;
  RETURN(TRUE);            
EXCEPTION                  --CRIANDO UMA EXCEPTION EXECUTAR O PROGRAMA CASO DÊ FALSE
  WHEN OTHERS THEN
    RETURN(FALSE); 
END;


DECLARE
  VCODIGO INTEGER := 1;
BEGIN
  IF EXISTE_ALUNO(VCODIGO) THEN
    DBMS_OUTPUT.PUT_LINE('CODIGO ENCONTRADO');
  ELSE
    DBMS_OUTPUT.PUT_LINE('CODIGO NAO ENCONTRADO');
  END IF;
END;


--UTILIZANDO PROCEDURE COM INSERT NA TABELA
CREATE OR REPLACE PROCEDURE CADASTRA_ALUNO --PROCEDURE CRIADA
(PCOD_ALUNO   IN TALUNO.COD_ALUNO%TYPE,    --PARÂMETROS DA PROCEDURE
 PNOME        IN TALUNO.NOME%TYPE,
 PCIDADE      IN TALUNO.CIDADE%TYPE,
 PESTADO      IN TALUNO.ESTADO%TYPE)
IS
BEGIN
  IF(NOT EXISTE_ALUNO(PCOD_ALUNO))THEN     --CONDIÇÃO CRIADA PARA SABER SE ALUNO EXISTE OU NAO. CASO NAO EXISTA SERÁ FEITO UM INSERT
     INSERT INTO TALUNO(COD_ALUNO, NOME, CIDADE, ESTADO)
     VALUES(PCOD_ALUNO, PNOME, PCIDADE, PESTADO);
     DBMS_OUTPUT.PUT_LINE('ALUNO CADASTRADO COM SUCESSO');
  ELSE                  
    DBMS_OUTPUT.PUT_LINE('CODIGO JA EXISTE');
  END IF;
END;

--COMO NAO TEM NECESSIDADE DO USO DE VARIÁVEIS, NÃO PRECISA USAR O DECLARE
BEGIN
  CADASTRA_ALUNO(18, 'PAULO','SÃO PAULO','SP');
END;
 

SELECT * FROM TALUNO;

