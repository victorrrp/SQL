--UTILIZANDO SELECT, INTO EM BEGIN

DECLARE
  VVALOR NUMBER(8,2);
  VNOME VARCHAR2(30);
BEGIN
  SELECT VALOR, NOME
  INTO VVALOR, VNOME
  FROM TCURSO
  WHERE COD_CURSO = &COD_CURSO;
  DBMS_OUTPUT.PUT_LINE('VALOR: '|| TO_CHAR(VVALOR, 'FM9999.99'));
  
  DBMS_OUTPUT.PUT_LINE('CURSO: '|| INITCAP(VNOME));
END;

SELECT * FROM TCURSO;


--INSERINDO E MANIPULANDO DADOS EM DECLARE E BEGIN
SELECT MAX(COD_CONTRATO) FROM TCONTRATO;
CREATE SEQUENCE SEQ_CONTRATO START WITH 8;

DECLARE
  VCOD TCONTRATO.COD_CONTRATO%TYPE;
BEGIN
  SELECT SEQ_CONTRATO.NEXTVAL
  INTO   VCOD FROM DUAL;
  
  INSERT INTO TCONTRATO(COD_CONTRATO, DATA,
                        COD_ALUNO, DESCONTO)
  VALUES(VCOD, SYSDATE, 2, NULL);
  
  DBMS_OUTPUT.PUT_LINE('CONTRATO CRIADO: '||VCOD);
END;

--PEGAR O VALOR ATUAL
SELECT SEQ_CONTRATO.CURRVAL FROM DUAL;

SELECT * FROM TCONTRATO;


--UPDATE TABELA TCURSO
DECLARE
  VVALOR TCURSO.VALOR%TYPE   :=&VALOR;
BEGIN
  UPDATE TCURSO SET
  VALOR = VALOR + VVALOR
  WHERE CARGA_HORARIA >= 30;
END;

--
SELECT * FROM TCURSO;


--DELETE
DECLARE 
  VCONTRATO TCONTRATO.COD_CONTRATO%TYPE  := &CONTRATO;
BEGIN
  DELETE FROM TCONTRATO
  WHERE COD_CONTRATO = VCONTRATO;
END; 

SELECT * FROM TCONTRATO;


/*EXEMPLO DE ERRO 'NO_DATA_FOUND' -> ACONTECE QUANDO É 
FEITO UM SELECT INTO E NÃO É ENCONTRADO NADA*/

DECLARE
  VDT_COMPRA    TCONTRATO.DATA%TYPE;
  VTOTAL        TCONTRATO.TOTAL%TYPE;
  VDT_ATUAL     DATE :=SYSDATE;
BEGIN
  SELECT DATA, TOTAL
  INTO   VDT_COMPRA, TOTAL
  FROM   TCONTRATO
  WHERE  DATA = VDT_ATUAL;
END;


--ALTERANDO CONTRATOS
DECLARE
  VCONTRATO   NUMBER := &COD_CONTRATO;
  VTEXTO VARCHAR2(50);
BEGIN
  UPDATE TCONTRATO SET
  DESCONTO = DESCONTO - 2
  WHERE COD_CONTRATO >= VCONTRATO;

  VTEXTO := SQL%ROWCOUNT; --RETORNA À VARIÁVEL A QTD DE REGISTROS AFETADOS PELO COMANDO SQL

  DBMS_OUTPUT.PUT_LINE(VTEXTO|| 'LINHAS ATUALIZADAS.');
END;


SELECT * FROM TCONTRATO;


